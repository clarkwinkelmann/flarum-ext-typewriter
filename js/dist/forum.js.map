{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@clarkwinkelmann/typewriter/webpack/bootstrap","webpack://@clarkwinkelmann/typewriter/webpack/runtime/compat get default export","webpack://@clarkwinkelmann/typewriter/webpack/runtime/define property getters","webpack://@clarkwinkelmann/typewriter/webpack/runtime/hasOwnProperty shorthand","webpack://@clarkwinkelmann/typewriter/webpack/runtime/make namespace object","webpack://@clarkwinkelmann/typewriter/external root \"flarum.core.compat['forum/app']\"","webpack://@clarkwinkelmann/typewriter/external root \"flarum.core.compat['common/extend']\"","webpack://@clarkwinkelmann/typewriter/external root \"flarum.core.compat['common/components/Tooltip']\"","webpack://@clarkwinkelmann/typewriter/external root \"flarum.core.compat['forum/components/Composer']\"","webpack://@clarkwinkelmann/typewriter/external root \"flarum.core.compat['forum/components/ComposerBody']\"","webpack://@clarkwinkelmann/typewriter/external root \"flarum.core.compat['forum/components/ComposerButton']\"","webpack://@clarkwinkelmann/typewriter/./src/forum/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Tooltip'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/Composer'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/ComposerBody'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/ComposerButton'];","import app from 'flarum/forum/app';\nimport {extend} from 'flarum/common/extend';\nimport Tooltip from 'flarum/common/components/Tooltip';\nimport Composer from 'flarum/forum/components/Composer';\nimport ComposerBody from 'flarum/forum/components/ComposerBody';\nimport ComposerButton from 'flarum/forum/components/ComposerButton';\n\ninterface Sound {\n    keys?: string\n    regex?: RegExp\n    file?: string\n}\n\nconst loadedFiles: {\n    [key: string]: HTMLAudioElement\n} = {};\n\nfunction isMuted(): boolean {\n    return app.session.user?.preferences().muteTypewriter;\n}\n\nfunction loadFile(file: string) {\n    if (Object.keys(loadedFiles).indexOf(file) !== -1) {\n        return;\n    }\n\n    loadedFiles[file] = new Audio(file);\n}\n\nfunction loadFiles() {\n    if (isMuted()) {\n        return;\n    }\n\n    let defaultFile = app.forum.attribute('typewriterDefaultFile') as string | undefined;\n\n    if (defaultFile) {\n        loadFile(defaultFile);\n    }\n\n    let sounds = app.forum.attribute('typewriterSounds') as Sound[] | undefined;\n\n    if (Array.isArray(sounds)) {\n        sounds.forEach(sound => {\n            if (sound.file) {\n                loadFile(sound.file);\n            }\n\n            if (sound.keys) {\n                sound.regex = new RegExp(sound.keys);\n            }\n        });\n    }\n}\n\nfunction playFile(file: string) {\n    if (isMuted()) {\n        return;\n    }\n\n    if (app.forum.attribute('debug')) {\n        console.info('[typewriter] Playing ' + file);\n    }\n\n    if (Object.keys(loadedFiles).indexOf(file) === -1) {\n        console.error('[typewriter] File ' + file + ' not loaded');\n        return;\n    }\n\n    const sound = loadedFiles[file].cloneNode(false) as HTMLAudioElement;\n\n    sound.play();\n}\n\nfunction pressedKey(key: string) {\n    let sounds = app.forum.attribute('typewriterSounds') as Sound[] | undefined;\n\n    if (Array.isArray(sounds)) {\n        for (let i = 0; i < sounds.length; i++) {\n            const sound = sounds[i];\n\n            if (!sound.regex || !sound.file) {\n                continue;\n            }\n\n            if (sound.regex.test(key)) {\n                playFile(sound.file);\n                return;\n            }\n        }\n    }\n\n    let defaultFile = app.forum.attribute('typewriterDefaultFile') as string | undefined;\n\n    if (defaultFile) {\n        playFile(defaultFile);\n    }\n}\n\nfunction composerKeyDown(event: KeyboardEvent) {\n    pressedKey(event.key);\n}\n\napp.initializers.add('typewriter', () => {\n    extend(Composer.prototype, 'controlItems', function (items) {\n        if (!app.session.user) {\n            return;\n        }\n\n        const muted = app.session.user.preferences().muteTypewriter;\n\n        items.add('typewriter', Tooltip.component({\n            text: app.translator.trans('clarkwinkelmann-typewriter.forum.mute'),\n        }, ComposerButton.component({\n            icon: 'typewriter-mute fas fa-' + (muted ? 'volume-mute' : 'volume-up'),\n            onclick: () => {\n                this.muteTypewriterLoading = true;\n\n                app.session.user.savePreferences({muteTypewriter: !muted}).then(() => {\n                    this.muteTypewriterLoading = false;\n                    m.redraw();\n\n                    loadFiles();\n                });\n            },\n            loading: this.muteTypewriterLoading,\n        })), 10);\n    });\n\n    extend(ComposerBody.prototype, 'oncreate', function () {\n        loadFiles();\n\n        this.element.addEventListener('keydown', composerKeyDown);\n    });\n\n    extend(ComposerBody.prototype, 'onremove', function () {\n        this.element.removeEventListener('keydown', composerKeyDown);\n    });\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","loadedFiles","isMuted","app","preferences","muteTypewriter","loadFile","file","keys","indexOf","Audio","loadFiles","defaultFile","sounds","Array","isArray","forEach","sound","regex","RegExp","playFile","console","info","cloneNode","play","error","composerKeyDown","event","i","length","test","pressedKey","extend","Composer","items","muted","add","Tooltip","text","ComposerButton","icon","onclick","muteTypewriterLoading","then","m","redraw","loading","this","ComposerBody","element","addEventListener","removeEventListener"],"sourceRoot":""}