{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@clarkwinkelmann/typewriter/webpack/bootstrap","webpack://@clarkwinkelmann/typewriter/webpack/runtime/compat get default export","webpack://@clarkwinkelmann/typewriter/webpack/runtime/define property getters","webpack://@clarkwinkelmann/typewriter/webpack/runtime/hasOwnProperty shorthand","webpack://@clarkwinkelmann/typewriter/webpack/runtime/make namespace object","webpack://@clarkwinkelmann/typewriter/external root \"flarum.core.compat['forum/app']\"","webpack://@clarkwinkelmann/typewriter/external root \"flarum.core.compat['common/extend']\"","webpack://@clarkwinkelmann/typewriter/external root \"flarum.core.compat['common/components/Button']\"","webpack://@clarkwinkelmann/typewriter/external root \"flarum.core.compat['common/components/Tooltip']\"","webpack://@clarkwinkelmann/typewriter/external root \"flarum.core.compat['forum/components/Composer']\"","webpack://@clarkwinkelmann/typewriter/external root \"flarum.core.compat['forum/components/ComposerBody']\"","webpack://@clarkwinkelmann/typewriter/external root \"flarum.core.compat['forum/components/ComposerButton']\"","webpack://@clarkwinkelmann/typewriter/./src/forum/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Tooltip'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/Composer'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/ComposerBody'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/ComposerButton'];","import app from 'flarum/forum/app';\nimport {extend} from 'flarum/common/extend';\nimport Button from 'flarum/common/components/Button';\nimport Tooltip from 'flarum/common/components/Tooltip';\nimport Composer from 'flarum/forum/components/Composer';\nimport ComposerBody from 'flarum/forum/components/ComposerBody';\nimport ComposerButton from 'flarum/forum/components/ComposerButton';\n\nlet showIntroductionPopup = window.localStorage.getItem('hideTypewriterIntroductionPopup') === '1' ? false : null;\n\ninterface Sound {\n    keys?: string\n    regex?: RegExp\n    file?: string\n}\n\nconst loadedFiles: {\n    [key: string]: HTMLAudioElement\n} = {};\n\nfunction isMuted(): boolean {\n    const preferenceValue = app.session.user?.preferences().muteTypewriter;\n\n    return preferenceValue === null ? app.forum.attribute('typewriterMuteByDefault') : preferenceValue;\n}\n\nfunction loadFile(file: string) {\n    if (Object.keys(loadedFiles).indexOf(file) !== -1) {\n        return;\n    }\n\n    loadedFiles[file] = new Audio(file);\n}\n\nfunction loadFiles() {\n    if (isMuted()) {\n        return;\n    }\n\n    let defaultFile = app.forum.attribute('typewriterDefaultFile') as string | undefined;\n\n    if (defaultFile) {\n        loadFile(defaultFile);\n    }\n\n    let sounds = app.forum.attribute('typewriterSounds') as Sound[] | undefined;\n\n    if (Array.isArray(sounds)) {\n        sounds.forEach(sound => {\n            if (sound.file) {\n                loadFile(sound.file);\n            }\n\n            if (sound.keys) {\n                sound.regex = new RegExp(sound.keys);\n            }\n        });\n    }\n}\n\nfunction playFile(file: string) {\n    if (showIntroductionPopup === null && app.forum.attribute('typewriterShowPopup')) {\n        showIntroductionPopup = true;\n        m.redraw();\n    }\n\n    if (isMuted()) {\n        return;\n    }\n\n    if (app.forum.attribute('debug')) {\n        console.info('[typewriter] Playing ' + file);\n    }\n\n    if (Object.keys(loadedFiles).indexOf(file) === -1) {\n        console.error('[typewriter] File ' + file + ' not loaded');\n        return;\n    }\n\n    const sound = loadedFiles[file].cloneNode(false) as HTMLAudioElement;\n\n    sound.play();\n}\n\nfunction pressedKey(key: string) {\n    let sounds = app.forum.attribute('typewriterSounds') as Sound[] | undefined;\n\n    if (Array.isArray(sounds)) {\n        for (let i = 0; i < sounds.length; i++) {\n            const sound = sounds[i];\n\n            if (!sound.regex || !sound.file) {\n                continue;\n            }\n\n            if (sound.regex.test(key)) {\n                playFile(sound.file);\n                return;\n            }\n        }\n    }\n\n    let defaultFile = app.forum.attribute('typewriterDefaultFile') as string | undefined;\n\n    if (defaultFile) {\n        playFile(defaultFile);\n    }\n}\n\nfunction composerKeyDown(event: KeyboardEvent) {\n    pressedKey(event.key);\n}\n\napp.initializers.add('typewriter', () => {\n    extend(Composer.prototype, 'controlItems', function (items) {\n        if (!app.session.user) {\n            return;\n        }\n\n        const preferenceValue = app.session.user.preferences().muteTypewriter;\n        const muted = preferenceValue === null ? app.forum.attribute('typewriterMuteByDefault') : preferenceValue;\n\n        items.add('typewriter', m('span.TypeWriterButtonWrapper', [\n            Tooltip.component({\n                text: app.translator.trans('clarkwinkelmann-typewriter.forum.' + (muted ? 'enable' : 'mute')),\n            }, ComposerButton.component({\n                icon: 'typewriter-mute fas fa-' + (muted ? 'volume-mute' : 'volume-up'),\n                onclick: () => {\n                    showIntroductionPopup = false;\n                    this.muteTypewriterLoading = true;\n\n                    app.session.user.savePreferences({muteTypewriter: !muted}).then(() => {\n                        this.muteTypewriterLoading = false;\n                        m.redraw();\n\n                        loadFiles();\n                    });\n                },\n                loading: this.muteTypewriterLoading,\n            })),\n            showIntroductionPopup ? m('.TypeWriterIntroductionPopup', [\n                app.translator.trans('clarkwinkelmann-typewriter.forum.introductionMessage'),\n                Button.component({\n                    'aria-label': app.translator.trans('core.lib.alert.dismiss_a11y_label'),\n                    icon: 'fas fa-times',\n                    class: 'Button Button--link Button--icon',\n                    onclick() {\n                        showIntroductionPopup = false;\n                        window.localStorage.setItem('hideTypewriterIntroductionPopup', '1');\n                    },\n                }),\n            ]) : null,\n        ]), 10);\n    });\n\n    extend(ComposerBody.prototype, 'oncreate', function () {\n        loadFiles();\n\n        // If the user already made a choice, never show the popup again\n        if (app.session.user?.preferences().muteTypewriter !== null) {\n            showIntroductionPopup = false;\n        }\n\n        this.element.addEventListener('keydown', composerKeyDown);\n    });\n\n    extend(ComposerBody.prototype, 'onremove', function () {\n        this.element.removeEventListener('keydown', composerKeyDown);\n    });\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","showIntroductionPopup","window","localStorage","getItem","loadedFiles","isMuted","preferenceValue","app","preferences","muteTypewriter","loadFile","file","keys","indexOf","Audio","loadFiles","defaultFile","sounds","Array","isArray","forEach","sound","regex","RegExp","playFile","m","redraw","console","info","cloneNode","play","error","composerKeyDown","event","i","length","test","pressedKey","extend","Composer","items","muted","add","Tooltip","text","ComposerButton","icon","onclick","muteTypewriterLoading","then","loading","this","Button","class","setItem","ComposerBody","element","addEventListener","removeEventListener"],"sourceRoot":""}