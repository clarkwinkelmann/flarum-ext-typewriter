(()=>{var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var o in r)e.o(r,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:r[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";e.r(t);const r=flarum.core.compat["forum/app"];var o=e.n(r);const n=flarum.core.compat["common/extend"],i=flarum.core.compat["common/components/Button"];var a=e.n(i);const u=flarum.core.compat["common/components/Tooltip"];var l=e.n(u);const s=flarum.core.compat["forum/components/Composer"];var c=e.n(s);const p=flarum.core.compat["forum/components/ComposerBody"];var f=e.n(p);const y=flarum.core.compat["forum/components/ComposerButton"];var d=e.n(y),w="1"!==window.localStorage.getItem("hideTypewriterIntroductionPopup")&&null,v={};function b(){var e,t=null==(e=o().session.user)?void 0:e.preferences().muteTypewriter;return null===t?o().forum.attribute("typewriterMuteByDefault"):t}function g(e){-1===Object.keys(v).indexOf(e)&&(v[e]=new Audio(e))}function k(){if(!b()){var e=o().forum.attribute("typewriterDefaultFile");e&&g(e);var t=o().forum.attribute("typewriterSounds");Array.isArray(t)&&t.forEach((function(e){e.file&&g(e.file),e.keys&&(e.regex=new RegExp(e.keys))}))}}function T(e){null===w&&o().forum.attribute("typewriterShowPopup")&&(w=!0,m.redraw()),b()||(o().forum.attribute("debug")&&console.info("[typewriter] Playing "+e),-1!==Object.keys(v).indexOf(e)?v[e].cloneNode(!1).play():console.error("[typewriter] File "+e+" not loaded"))}function x(e){!function(e){var t=o().forum.attribute("typewriterSounds");if(Array.isArray(t))for(var r=0;r<t.length;r++){var n=t[r];if(n.regex&&n.file&&n.regex.test(e))return void T(n.file)}var i=o().forum.attribute("typewriterDefaultFile");i&&T(i)}(e.key)}o().initializers.add("typewriter",(function(){(0,n.extend)(c().prototype,"controlItems",(function(e){var t=this;if(o().session.user){var r=o().session.user.preferences().muteTypewriter,n=null===r?o().forum.attribute("typewriterMuteByDefault"):r;e.add("typewriter",m("span.TypeWriterButtonWrapper",[l().component({text:o().translator.trans("clarkwinkelmann-typewriter.forum."+(n?"enable":"mute"))},d().component({icon:"typewriter-mute fas fa-"+(n?"volume-mute":"volume-up"),onclick:function(){w=!1,t.muteTypewriterLoading=!0,o().session.user.savePreferences({muteTypewriter:!n}).then((function(){t.muteTypewriterLoading=!1,m.redraw(),k()}))},loading:this.muteTypewriterLoading})),w?m(".TypeWriterIntroductionPopup",[o().translator.trans("clarkwinkelmann-typewriter.forum.introductionMessage"),a().component({"aria-label":o().translator.trans("core.lib.alert.dismiss_a11y_label"),icon:"fas fa-times",class:"Button Button--link Button--icon",onclick:function(){w=!1,window.localStorage.setItem("hideTypewriterIntroductionPopup","1")}})]):null]),10)}})),(0,n.extend)(f().prototype,"oncreate",(function(){var e;k(),null!==(null==(e=o().session.user)?void 0:e.preferences().muteTypewriter)&&(w=!1),this.element.addEventListener("keydown",x)})),(0,n.extend)(f().prototype,"onremove",(function(){this.element.removeEventListener("keydown",x)}))}))})(),module.exports=t})();
//# sourceMappingURL=forum.js.map